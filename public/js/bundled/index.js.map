{"mappings":"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","sources":["public/js/alerts.js","public/js/updateSettings.js","public/js/stripe.js","public/js/index.js","public/js/login.js","public/js/mapbox.js"],"sourcesContent":["/* eslint-disable */\n\n// hide alert\nexport const hideAlert = () => {\n  const el = document.querySelector('.alert');\n  if (el) el.parentElement.removeChild(el);\n};\n\n// type = success || error\nexport const showAlert = (type, msg) => {\n  hideAlert();\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\n  window.setTimeout(hideAlert, 5000);\n};\n","/* eslint-disable */\nimport { showAlert } from './alerts';\n\n// type is either 'password' or 'data'.\nexport const updateSettings = async function (data, type) {\n  try {\n    const url =\n      type === 'password'\n        ? '/api/v1/users/updateMyPassword'\n        : '/api/v1/users/updateMe';\n    const res = await axios({\n      method: 'PATCH',\n      url,\n      data,\n    });\n\n    if (res.data.status === 'success') {\n      showAlert('success', `${type.toUpperCase()} updated successfully`);\n    }\n  } catch (e) {\n    showAlert('error', e.response.data.message);\n  }\n};\n","/* eslint-disable */\n\nimport { showAlert } from './alerts';\n\nconst stripe = Stripe(\n  'pk_test_51L0YwsLCiKQlQb4oS56q9wDgZhGsqNUeQHaUYTZtIkOTsVIHLPyziJa4Dbki7vxLnQdFgON9cJtcnD7ziU3txMKd00sjHL01xQ'\n);\n\nexport const bookTour = async (tourID) => {\n  try {\n    // 1. Have a checkout session created by the server on the server side (server talks to stripe and creates a session)\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourID}`);\n    console.log(session);\n\n    // 2. Create checkout form + charge credit card}\n    await stripe.redirectToCheckout({\n      sessionId: session.data.data.session.id,\n    });\n    console.log('after the payment');\n  } catch (err) {\n    console.error(err);\n    showAlert('error', err);\n  }\n};\n","/* eslint-disable */\nimport { login, logout } from './login';\nimport { displayMap } from './mapbox';\nimport { updateSettings } from './updateSettings';\nimport { bookTour } from './stripe';\n\nconst mapEl = document.getElementById('map');\nconst loginForm = document.querySelector('.form--login');\nconst logoutButton = document.querySelector('.nav__el--logout');\nconst userDataForm = document.querySelector('.form-user-data');\nconst userPasswordForm = document.querySelector('.form-user-password');\nconst bookNowButton = document.getElementById('book-tour');\n\nif (loginForm) {\n  loginForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const email = document.getElementById('email').value;\n    const password = document.getElementById('password').value;\n    login(email, password);\n  });\n}\n\nif (mapEl) {\n  const locations = JSON.parse(mapEl.dataset.locations);\n  displayMap(locations);\n}\n\nif (logoutButton) {\n  logoutButton.addEventListener('click', (e) => {\n    e.preventDefault();\n    logout();\n  });\n}\n\nif (userDataForm) {\n  userDataForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const form = new FormData();\n    form.append('name', document.getElementById('name').value);\n    form.append('email', document.getElementById('email').value);\n    form.append('photo', document.getElementById('photo').files[0]);\n    console.log(form);\n    updateSettings(form, 'data');\n  });\n}\n\nif (userPasswordForm) {\n  userPasswordForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    document.querySelector('.btn--save-password').value =\n      'Updating password...';\n    const currPassword = document.getElementById('password-current').value;\n    const password = document.getElementById('password').value;\n    const passwordConfirm = document.getElementById('password-confirm').value;\n    await updateSettings(\n      { currPassword, password, passwordConfirm },\n      'password'\n    );\n    document.querySelector('.btn--save-password').textContent = 'Save password';\n    document.getElementById('password-current').value = '';\n    document.getElementById('password').value = '';\n    document.getElementById('password-confirm').value = '';\n  });\n}\n\nif (bookNowButton) {\n  bookNowButton.addEventListener('click', (e) => {\n    e.target.textContent = 'Processing...';\n    const tourID = e.target.dataset.tourId;\n    bookTour(tourID);\n  });\n}\n","/* eslint-disable */\nimport { showAlert } from './alerts';\n\nexport const login = async function (email, password) {\n  try {\n    const res = await axios({\n      method: 'POST',\n      url: '/api/v1/users/login',\n      data: {\n        email,\n        password,\n      },\n    });\n\n    if (res.data.status === 'success') {\n      showAlert('success', 'Logged in successfully');\n      window.setTimeout(() => location.assign('/'), 1500);\n    }\n  } catch (e) {\n    showAlert('error', e.response.data.message);\n  }\n};\n\nexport const logout = async function () {\n  try {\n    console.log('Inside logout');\n\n    const res = await axios({\n      method: 'GET',\n      url: '/api/v1/users/logout',\n    });\n\n    console.log('Inside logout');\n\n    if (res.data.status === 'success') {\n      showAlert('success', 'Logged out successfully');\n      location.reload(true);\n    }\n  } catch (e) {\n    console.log(e);\n    showAlert('error', 'Error logging out. Please try again!');\n  }\n};\n","/* eslint-disable */\nexport const displayMap = (locations) => {\n  mapboxgl.accessToken =\n    'pk.eyJ1IjoicGVuYW1hbmsiLCJhIjoiY2wyZ3ExZzI1MDQwbDNjbjcxcm01ZXh6ayJ9.cMQSgTHYlnO7qVvhV8JZgw';\n  const map = new mapboxgl.Map({\n    container: 'map', // container ID\n    style: 'mapbox://styles/penamank/cl2grrnos000t14pmsrw5hx3j', // style URL\n    scrollZoom: false,\n    center: [-84.4010024, 39.0998549], // starting position [lng, lat]\n    zoom: 100, // starting zoom\n    interactive: true,\n  });\n\n  const bounds = new mapboxgl.LngLatBounds();\n\n  locations.forEach((loc) => {\n    // Create marker\n    const el = document.createElement('div');\n    el.className = 'marker';\n\n    // Add marker to mapbox map\n    new mapboxgl.Marker({\n      element: el,\n      anchor: 'bottom',\n    })\n      .setLngLat(loc.coordinates)\n      .addTo(map);\n\n    // Add popup\n    new mapboxgl.Popup({\n      offset: 30,\n    })\n      .setLngLat(loc.coordinates)\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\n      .addTo(map);\n\n    // Extend the map view to include the location\n    bounds.extend(loc.coordinates);\n  });\n\n  map.fitBounds(bounds, {\n    padding: {\n      top: 200,\n      bottom: 150,\n      left: 100,\n      right: 100,\n    },\n  });\n};\n"],"names":["$7dc87b7f457e655a$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$7dc87b7f457e655a$export$de026b00723010c1","type","msg","markup","insertAdjacentHTML","window","setTimeout","$955535ce7513e32c$export$f558026a994b6051","async","data","url","axios","method","status","toUpperCase","e","response","message","$9fd71c92b6f885af$var$stripe","Stripe","$407eccdc61ba7a94$var$mapEl","getElementById","$407eccdc61ba7a94$var$loginForm","$407eccdc61ba7a94$var$logoutButton","$407eccdc61ba7a94$var$userDataForm","$407eccdc61ba7a94$var$userPasswordForm","$407eccdc61ba7a94$var$bookNowButton","addEventListener","preventDefault","email","password","location","assign","$bf5b431e6a69fea8$export$596d806903d1f59e","value","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","center","zoom","interactive","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$3c4e158d14605c12$export$4c5dd147b21b9176","JSON","parse","dataset","console","log","res","reload","$bf5b431e6a69fea8$export$a0973bcfe11b05c9","form","FormData","append","files","currPassword","passwordConfirm","textContent","target","tourID","session","redirectToCheckout","sessionId","id","err","error","$9fd71c92b6f885af$export$8d5bdbf26681c0c2","tourId"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}